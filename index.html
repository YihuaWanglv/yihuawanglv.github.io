<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



















  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Source Code Pro:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.4.1" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.4.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.4.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.4.1">


  <link rel="mask-icon" href="/images/logo.svg?v=6.4.1" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.4.1',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="iyihua">
<meta property="og:url" content="http://localhost:4000/index.html">
<meta property="og:site_name" content="iyihua">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iyihua">



  <link rel="alternate" href="/atom.xml" title="iyihua" type="application/atom+xml">




  <link rel="canonical" href="http://localhost:4000/">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>iyihua</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">iyihua</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>
  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://localhost:4000/2019/11/18/记一次线上卡顿问题的处理-Mysql的Lock-wait-timeout/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wanglv Yihua">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/default_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="iyihua">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/11/18/记一次线上卡顿问题的处理-Mysql的Lock-wait-timeout/" itemprop="url">
                  记一次线上卡顿问题的处理-Mysql的Lock wait timeout
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-11-18 15:09:04 / 修改时间：15:11:55" itemprop="dateCreated datePublished" datetime="2019-11-18T15:09:04+08:00">2019-11-18</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/exception/" itemprop="url" rel="index"><span itemprop="name">exception</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>记一次线上卡顿问题的处理-Mysql的Lock wait timeout</p>
<h2 id="问题表现："><a href="#问题表现：" class="headerlink" title="问题表现："></a>问题表现：</h2><ul>
<li><p>1.程序jdbc连接Mysql报错’Lock wait timeout exceeded;try restarting transaction’</p>
</li>
<li><p>2.页面某2个操作提交卡住，一直转</p>
</li>
</ul>
<h2 id="排查："><a href="#排查：" class="headerlink" title="排查："></a>排查：</h2><p>使用<code>show processlist</code>和<code>select * from information_schema.innodb_trx</code>会看到有一些等待中的mysql线程</p>
<p>可以用kill命令把这些mysql线程kill掉，但这只是暂时紧急应对，没有定位到真正的问题所在。<br><code></code><br>出现锁等待超时的情况，一般可能会是因为一个sql执行完，但未commit，接下来的sql要执行就会被锁，直到完成或者超时结束。</p>
<p>继续对问题进行分析。</p>
<p>出现等待的两个sql分别是<code>insert ignore into biz_customer_contact...</code>以及<code>update customer ...</code>，而这2个表只是百万级的表，正常的插入和更新表操作一般不会造成等待和锁定，因此考虑不是sql本身的问题，sql本身不用进行优化。</p>
<p>同时，出现锁定超时的问题仅仅是这2个地方这2个sql，而其它地方没有出现问题，因此也排除是整个数据库出现性能问题。</p>
<p>再深入问题，找到这2个sql执行所在的程序代码，review代码后，发现两者有一个共性特征，就是两者都需要调用一个其它系统的接口来完成业务操作。考虑到网络调用或者I/O操作是很可能出现阻塞等待的情况的，因此怀疑是接口调用等待的时间太长，导致数据库事务一直在等待，最后导致超时，出现上面的线程等待问题和异常报错。</p>
<p>针对这个问题，专门测试了依赖的接口和咨询对应系统的运维后，确认，依赖的系统确实当时正出现问题。因此定位到问题所在。</p>
<h2 id="定位到问题后，就要做适当的处理，处理方案为："><a href="#定位到问题后，就要做适当的处理，处理方案为：" class="headerlink" title="定位到问题后，就要做适当的处理，处理方案为："></a>定位到问题后，就要做适当的处理，处理方案为：</h2><ul>
<li>1.恢复出现问题的服务</li>
<li>2.将接口调用的超时时间缩短，原来是没有设置这个时间的。缩短接口超时时间的目的是假如服务不可用，则快速失败抛出错误，避免系统一直等待卡顿。</li>
<li>3.适当设置mysql数据库的锁等待超时时间，例如<code>set GLOBAL innodb_lock_wait_timeout = 5000</code>，缩短等待超时时间，目的也是避免高并发时太多线程在等待拖垮系统。</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://localhost:4000/2019/11/18/Mysql的PARTITION表分区要点/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wanglv Yihua">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/default_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="iyihua">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/11/18/Mysql的PARTITION表分区要点/" itemprop="url">
                  Mysql的PARTITION表分区要点
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-11-18 11:46:18 / 修改时间：12:51:40" itemprop="dateCreated datePublished" datetime="2019-11-18T11:46:18+08:00">2019-11-18</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/mysql/" itemprop="url" rel="index"><span itemprop="name">mysql</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Mysql自带的Partition分区方案好处：</p>
<p>优势1，数据库操作变更简单；<br>优势2，分区后程序不需要修改，数据库分区的表使用和分区前一致；<br>优势3，分区后，查询效率没有降低。</p>
<h1 id="1-建立分区步骤"><a href="#1-建立分区步骤" class="headerlink" title="1. 建立分区步骤"></a>1. 建立分区步骤</h1><p>现在假设<code>biz_process</code>和<code>biz_follow</code>是2张大表，现在要对它们进行mysql数据库表分区</p>
<p>有2种推荐的方式进行表分区：</p>
<ul>
<li><p>一是，先进行备份，再对需要分区的表直接使用<code>ALTER TABLE</code>进行分区设置</p>
</li>
<li><p>二是，先创建使用别名的分区表，再复制数据进分区表，最后变更表名字原来的表和分区表切换。</p>
</li>
</ul>
<h2 id="1-1-创建需要分区的表的备份"><a href="#1-1-创建需要分区的表的备份" class="headerlink" title="1.1 创建需要分区的表的备份"></a>1.1 创建需要分区的表的备份</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`biz_process_bak`</span> (</span><br><span class="line">  <span class="string">`process_id`</span> <span class="built_in">bigint</span>(<span class="number">20</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">'流程编号'</span>,</span><br><span class="line">  <span class="string">`customer_id`</span> <span class="built_in">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'客户编号'</span>,</span><br><span class="line">  <span class="string">`dept_id`</span> <span class="built_in">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'业务部门编号'</span>,</span><br><span class="line">  <span class="string">`user_id`</span> <span class="built_in">bigint</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'业务人员编号'</span>,</span><br><span class="line">  <span class="comment">--···建表语句</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4 <span class="keyword">COLLATE</span>=utf8mb4_unicode_ci <span class="keyword">COMMENT</span>=<span class="string">'商机流程表'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`biz_follow_bak`</span> (</span><br><span class="line">  <span class="string">`follow_id`</span> <span class="built_in">bigint</span>(<span class="number">11</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">'跟进编号'</span>,</span><br><span class="line">  <span class="string">`customer_id`</span> <span class="built_in">bigint</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'客户编号'</span>,</span><br><span class="line">  <span class="string">`process_id`</span> <span class="built_in">bigint</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'流程编号'</span>,</span><br><span class="line">  <span class="comment">--···建表语句</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4 <span class="keyword">COLLATE</span>=utf8mb4_unicode_ci <span class="keyword">COMMENT</span>=<span class="string">'客户跟进表'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> biz_process_bak <span class="keyword">select</span> * <span class="keyword">from</span> biz_process;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> biz_follow_bak <span class="keyword">select</span> * <span class="keyword">from</span> biz_follow;</span><br></pre></td></tr></table></figure>
<h2 id="1-2-创建别名分区表，并复制数据进分区表"><a href="#1-2-创建别名分区表，并复制数据进分区表" class="headerlink" title="1.2 创建别名分区表，并复制数据进分区表"></a>1.2 创建别名分区表，并复制数据进分区表</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`biz_process_range`</span> (</span><br><span class="line">  <span class="string">`process_id`</span> <span class="built_in">bigint</span>(<span class="number">20</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">'流程编号'</span>,</span><br><span class="line">  <span class="string">`customer_id`</span> <span class="built_in">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'客户编号'</span>,</span><br><span class="line">  <span class="string">`dept_id`</span> <span class="built_in">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'业务部门编号'</span>,</span><br><span class="line">  <span class="string">`user_id`</span> <span class="built_in">bigint</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'业务人员编号'</span>,</span><br><span class="line">  <span class="comment">--···建表语句</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4 <span class="keyword">COLLATE</span>=utf8mb4_unicode_ci <span class="keyword">COMMENT</span>=<span class="string">'商机流程表'</span> <span class="keyword">PARTITION</span> <span class="keyword">BY</span> <span class="keyword">RANGE</span>(process_id) (</span><br><span class="line">    <span class="keyword">PARTITION</span> p1 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">2000000</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p2 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">4000000</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p3 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">6000000</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p4 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">8000000</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p5 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">10000000</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p6 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">12000000</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p7 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">14000000</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p8 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">16000000</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p9 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">18000000</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p10 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">20000000</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p11 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (MAXVALUE) </span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`biz_follow_range`</span> (</span><br><span class="line">  <span class="string">`follow_id`</span> <span class="built_in">bigint</span>(<span class="number">11</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">'跟进编号'</span>,</span><br><span class="line">  <span class="string">`customer_id`</span> <span class="built_in">bigint</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'客户编号'</span>,</span><br><span class="line">  <span class="string">`process_id`</span> <span class="built_in">bigint</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'流程编号'</span>,</span><br><span class="line">  <span class="comment">--···建表语句</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4 <span class="keyword">COLLATE</span>=utf8mb4_unicode_ci <span class="keyword">COMMENT</span>=<span class="string">'客户跟进表'</span> <span class="keyword">PARTITION</span> <span class="keyword">BY</span> <span class="keyword">RANGE</span>(follow_id) (</span><br><span class="line">    <span class="keyword">PARTITION</span> p1 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">2000000</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p2 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">4000000</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p3 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">6000000</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p4 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">8000000</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p5 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">10000000</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p6 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">12000000</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p7 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">14000000</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p8 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">16000000</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p9 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">18000000</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p10 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">20000000</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p11 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (MAXVALUE) </span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> biz_process_range <span class="keyword">select</span> * <span class="keyword">from</span> biz_process;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> biz_follow_range <span class="keyword">select</span> * <span class="keyword">from</span> biz_follow;</span><br></pre></td></tr></table></figure>
<h2 id="1-3-使用重命名快速把原表切换到分区表"><a href="#1-3-使用重命名快速把原表切换到分区表" class="headerlink" title="1.3 使用重命名快速把原表切换到分区表"></a>1.3 使用重命名快速把原表切换到分区表</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RENAME</span> <span class="keyword">TABLE</span> biz_process <span class="keyword">TO</span> biz_process_tmp, biz_process_range <span class="keyword">TO</span> biz_process;</span><br><span class="line"><span class="keyword">RENAME</span> <span class="keyword">TABLE</span> biz_follow <span class="keyword">TO</span> biz_follow_tmp, biz_follow_range <span class="keyword">TO</span> biz_follow;</span><br></pre></td></tr></table></figure>
<p>ps. 也可以直接使用ALTER TABLE的方式，直接为原来的表添加分区</p>
<h1 id="2-关于分区新增和变更删除等操作"><a href="#2-关于分区新增和变更删除等操作" class="headerlink" title="2. 关于分区新增和变更删除等操作"></a>2. 关于分区新增和变更删除等操作</h1><h2 id="2-1-为当前表创建分区"><a href="#2-1-为当前表创建分区" class="headerlink" title="2.1 为当前表创建分区"></a>2.1 为当前表创建分区</h2><p>因为是对已有表进行改造，所以只能用 alter 的方式：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> stat</span><br><span class="line">    <span class="keyword">PARTITION</span> <span class="keyword">BY</span> <span class="keyword">RANGE</span>(<span class="keyword">TO_DAYS</span>(dt)) (</span><br><span class="line">        <span class="keyword">PARTITION</span> p0 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span>(<span class="number">0</span>),</span><br><span class="line">        <span class="keyword">PARTITION</span> p190214 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span>(<span class="keyword">TO_DAYS</span>(<span class="string">'2019-02-14'</span>)),</span><br><span class="line">        <span class="keyword">PARTITION</span> pm <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span>(MAXVALUE)</span><br><span class="line">    );</span><br></pre></td></tr></table></figure></p>
<p>复制代码这里有2点要注意：</p>
<ul>
<li>一是 p0 分区，这是因为 MySQL（我是5.7版） 有个 bug，就是不管你查的数据在哪个区，它都会扫一下第一个区，我们每个区的数据都有几十万条，扫一下很是肉疼啊，所以为了避免不必要的扫描，直接弄个0数据分区就行了。</li>
<li>二是 pm 分区，这个是最大分区。假如不要 pm，那你存 2019-02-15 的数据就会报错。所以 pm 实际上是给未来的数据一个预留的分区。</li>
</ul>
<h2 id="2-2-定期扩展分区"><a href="#2-2-定期扩展分区" class="headerlink" title="2.2 定期扩展分区"></a>2.2 定期扩展分区</h2><p>由于 MySQL 的分区并不能自己动态扩容，所以我们要写个代码为它动态的增加分区。</p>
<p>增加分区需要用到 REORGANIZE 命令，它的作用是对某个分区重新分配。</p>
<p>比如明天是 15 号，那我们要给 15 号也增加个分区，实际上就是把 pm 分区拆分成2个分区：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> stat</span><br><span class="line">    REORGANIZE <span class="keyword">PARTITION</span> pm <span class="keyword">INTO</span> (</span><br><span class="line">        <span class="keyword">PARTITION</span> p190215 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span>(<span class="keyword">TO_DAYS</span>(<span class="string">'2019-02-15'</span>)),</span><br><span class="line">        <span class="keyword">PARTITION</span> pm <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span>(MAXVALUE)</span><br><span class="line">    );</span><br></pre></td></tr></table></figure></p>
<p>复制代码这里就涉及到一个问题，即如何获得当前表的所有分区？网上有挺多方法，但我试了下感觉还是先 <code>show create table stat</code>然后用正则匹配出所有分区更方便一点。</p>
<h2 id="2-3-定期删除分区"><a href="#2-3-定期删除分区" class="headerlink" title="2.3 定期删除分区"></a>2.3 定期删除分区</h2><p>随着数据库越来越大，我们肯定是要清除旧的数据，同时也要清除旧的分区。<br>这个也比较简单：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> stat <span class="keyword">DROP</span> <span class="keyword">PARTITION</span> p190214, p190215</span><br></pre></td></tr></table></figure></p>
<h1 id="3-附录：Mysql的Partition分区使用说明"><a href="#3-附录：Mysql的Partition分区使用说明" class="headerlink" title="3. 附录：Mysql的Partition分区使用说明"></a>3. 附录：Mysql的Partition分区使用说明</h1><h2 id="3-1-基于时间进行range分区例子："><a href="#3-1-基于时间进行range分区例子：" class="headerlink" title="3.1 基于时间进行range分区例子："></a>3.1 基于时间进行range分区例子：</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> my_range_datetime(</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">INT</span>,</span><br><span class="line">    hiredate DATETIME</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">INNODB</span> <span class="keyword">PARTITION</span> <span class="keyword">BY</span> <span class="keyword">RANGE</span> (<span class="keyword">YEAR</span>(hiredate) ) (</span><br><span class="line">    <span class="keyword">PARTITION</span> p1 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">2011</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p2 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">2012</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p3 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">2013</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p4 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">2014</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p5 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">2015</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p6 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">2016</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p7 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">2017</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p8 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">2018</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p9 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">2019</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p10 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">2020</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p11 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (MAXVALUE) </span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h2 id="3-2-基于主键进行range分区例子：由于表如果设置了主键的话，分区的字段一定要属于主键，所以一般要么把分区字段添加为主键，要么就只能针对主键进行分区"><a href="#3-2-基于主键进行range分区例子：由于表如果设置了主键的话，分区的字段一定要属于主键，所以一般要么把分区字段添加为主键，要么就只能针对主键进行分区" class="headerlink" title="3.2 基于主键进行range分区例子：由于表如果设置了主键的话，分区的字段一定要属于主键，所以一般要么把分区字段添加为主键，要么就只能针对主键进行分区"></a>3.2 基于主键进行range分区例子：由于表如果设置了主键的话，分区的字段一定要属于主键，所以一般要么把分区字段添加为主键，要么就只能针对主键进行分区</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`range_process`</span> (</span><br><span class="line">  <span class="string">`process_id`</span> <span class="built_in">bigint</span>(<span class="number">20</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">'流程编号'</span>,</span><br><span class="line">  <span class="string">`customer_id`</span> <span class="built_in">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'客户编号'</span>,</span><br><span class="line">  <span class="string">`dept_id`</span> <span class="built_in">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'业务部门编号'</span>,</span><br><span class="line">  <span class="string">`memo`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'备注'</span>,</span><br><span class="line">  <span class="string">`create_time`</span> <span class="built_in">timestamp</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">COMMENT</span> <span class="string">'创建时间'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`process_id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`IX_DEPT_ID`</span> (<span class="string">`dept_id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`IX_CREATE_TIME`</span> (<span class="string">`create_time`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`IX_CUSTOMER_ID`</span> (<span class="string">`customer_id`</span>) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`IX_MEMO`</span> (<span class="string">`memo`</span>) <span class="keyword">USING</span> BTREE</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4 <span class="keyword">COLLATE</span>=utf8mb4_unicode_ci <span class="keyword">COMMENT</span>=<span class="string">'商机流程表'</span> <span class="keyword">PARTITION</span> <span class="keyword">BY</span> <span class="keyword">RANGE</span>(process_id) (</span><br><span class="line">    <span class="keyword">PARTITION</span> p1 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">1000</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p2 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">2000</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p3 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (<span class="number">3000</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p4 <span class="keyword">VALUES</span> <span class="keyword">LESS</span> <span class="keyword">THAN</span> (MAXVALUE) </span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h2 id="3-3-分区后，如果在查询时想要避免搜索所有分区，则最好在查询的where条件中添加分区字段作为过滤条件。哪怕是冗余的没有必要的过滤条件，对于定位分区还是有用的。"><a href="#3-3-分区后，如果在查询时想要避免搜索所有分区，则最好在查询的where条件中添加分区字段作为过滤条件。哪怕是冗余的没有必要的过滤条件，对于定位分区还是有用的。" class="headerlink" title="3.3 分区后，如果在查询时想要避免搜索所有分区，则最好在查询的where条件中添加分区字段作为过滤条件。哪怕是冗余的没有必要的过滤条件，对于定位分区还是有用的。"></a>3.3 分区后，如果在查询时想要避免搜索所有分区，则最好在查询的where条件中添加分区字段作为过滤条件。哪怕是冗余的没有必要的过滤条件，对于定位分区还是有用的。</h2><p>例如，普通查询<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; EXPLAIN PARTITIONS select * from range_process \G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: range_process</span><br><span class="line">   partitions: p1,p2,p3,p4</span><br><span class="line">         type: ALL</span><br><span class="line">possible_keys: NULL</span><br><span class="line">          key: NULL</span><br><span class="line">      key_len: NULL</span><br><span class="line">          ref: NULL</span><br><span class="line">         rows: 20</span><br><span class="line">     filtered: 100.00</span><br><span class="line">        Extra: NULL</span><br><span class="line">1 row in set, 2 warnings (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<p>添加主键作为where条件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN PARTITIONS select * from range_process where process_id &gt; 3000 \G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: range_process</span><br><span class="line">   partitions: p4</span><br><span class="line">         type: range</span><br><span class="line">possible_keys: PRIMARY</span><br><span class="line">          key: PRIMARY</span><br><span class="line">      key_len: 8</span><br><span class="line">          ref: NULL</span><br><span class="line">         rows: 10</span><br><span class="line">     filtered: 100.00</span><br><span class="line">        Extra: Using where</span><br><span class="line">1 row in set, 2 warnings (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<ul>
<li>在应用层，对于做了分区的大表，进行查询时，可以通过动态sql的方式，在需要优化的sql查询处加入分区字段作为where的过滤条件。</li>
</ul>
<h2 id="3-4-分区表使用的限制"><a href="#3-4-分区表使用的限制" class="headerlink" title="3.4 分区表使用的限制"></a>3.4 分区表使用的限制</h2><ul>
<li>一个表最多只能有1024个分区</li>
<li>主键和唯一索引的列，必须作为分区的字段</li>
</ul>
<h2 id="3-5-分区后，一般情况下，各种查询使用和join联表操作均正常使用，和分区前一致，但要注意几个问题"><a href="#3-5-分区后，一般情况下，各种查询使用和join联表操作均正常使用，和分区前一致，但要注意几个问题" class="headerlink" title="3.5 分区后，一般情况下，各种查询使用和join联表操作均正常使用，和分区前一致，但要注意几个问题"></a>3.5 分区后，一般情况下，各种查询使用和join联表操作均正常使用，和分区前一致，但要注意几个问题</h2><ul>
<li>关于优化，应该尽量使用where条件，将检索的分区限制再少数分区中。</li>
<li>（mysql5.5以上不需要考虑这个问题）NULL值会使分区过滤无效，并在分区中创建一个默认的第一个分区，从而导致所有查询都会默认去检索这个分区，所以，应该创建一个“无用”的第一个分区，导致数据无法落入这个分区，从而避免mysql查询每次检索第一个分区。mysql5.5以上不需要考虑这个问题，可以直接使用列本身进行分区，就不会有这个问题。</li>
<li>对于大多数系统，100个左右的分区是可以接受的，不会有太大问题。</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://localhost:4000/2019/11/18/配置Maven项目打包部署到Nexus私服/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wanglv Yihua">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/default_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="iyihua">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/11/18/配置Maven项目打包部署到Nexus私服/" itemprop="url">
                  配置Maven项目打包部署到Nexus私服
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-11-18 11:36:26 / 修改时间：11:44:23" itemprop="dateCreated datePublished" datetime="2019-11-18T11:36:26+08:00">2019-11-18</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="配置Maven项目打包部署到Nexus私服"><a href="#配置Maven项目打包部署到Nexus私服" class="headerlink" title="配置Maven项目打包部署到Nexus私服"></a>配置Maven项目打包部署到Nexus私服</h1><p>要点总结：</p>
<ul>
<li>对于公共二方库的开发人员，需要配置maven/conf下setting.xml配置,增加<servers>节点。项目中已添加私服仓库地址和部署插件，开发人员不需要再配置。</servers></li>
<li>对于使用公共二方库的项目，需要在maven配置文件中的mirrors添加<mirror>镜像。也可以在项目的pom文件中添加仓库，然后在pom文件中添加需要使用的库的<dependency>即可。</dependency></mirror></li>
</ul>
<h1 id="1-maven-conf下setting-xml配置-增加节点"><a href="#1-maven-conf下setting-xml配置-增加节点" class="headerlink" title="1. maven/conf下setting.xml配置,增加节点"></a>1. maven/conf下setting.xml配置,增加<servers>节点</servers></h1><p>增加<servers>节点<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>maven-public<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">username</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">password</span>&gt;</span>devmvn.db<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>maven-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">username</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">password</span>&gt;</span>devmvn.db<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>maven-releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">username</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">password</span>&gt;</span>devmvn.db<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servers</span>&gt;</span></span><br></pre></td></tr></table></figure></servers></p>
<h1 id="2-二方库项目中pom-xml配置，增加distributionManagement节点，注意与properties节点平级。"><a href="#2-二方库项目中pom-xml配置，增加distributionManagement节点，注意与properties节点平级。" class="headerlink" title="2. 二方库项目中pom.xml配置，增加distributionManagement节点，注意与properties节点平级。"></a>2. 二方库项目中pom.xml配置，增加distributionManagement节点，注意与properties节点平级。</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>maven-releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>maven-releases<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://ip:port/repository/maven-releases/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layout</span>&gt;</span>default<span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>maven-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>maven-snapshots<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://ip:port/repository/maven-snapshots/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>需要打包部署到私服的工程，则执行maven命令<code>mvn clean deploy</code>即可</li>
</ul>
<h1 id="3-需要使用依赖的二方库的工程，则需要在maven的conf中配置mirrors节点，或者在工程的pom文件中配置好私服仓库地址"><a href="#3-需要使用依赖的二方库的工程，则需要在maven的conf中配置mirrors节点，或者在工程的pom文件中配置好私服仓库地址" class="headerlink" title="3. 需要使用依赖的二方库的工程，则需要在maven的conf中配置mirrors节点，或者在工程的pom文件中配置好私服仓库地址"></a>3. 需要使用依赖的二方库的工程，则需要在maven的conf中配置mirrors节点，或者在工程的pom文件中配置好私服仓库地址</h1><ul>
<li>方式1：mirrors:</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirror</span>&gt;</span>     </span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>bolingcavalry-nexus-releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span>     </span><br><span class="line">    <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span>     </span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://ip:port/repository/maven-public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span>     </span><br><span class="line"><span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>方式2：在工程的pom文件中配置私服仓库地址</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>maven-public<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>maven-public<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://ip:port/repository/maven-public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="4-依赖准备"><a href="#4-依赖准备" class="headerlink" title="4. 依赖准备"></a>4. 依赖准备</h1><ol>
<li>在Nexus服务器上创建一个能deploy的Nexus账号用户名和密码</li>
<li>设置账号为允许上传release的jar包</li>
<li>设置账号为允许上传snapshots的jar包</li>
</ol>
<h1 id="5-备选配置记录"><a href="#5-备选配置记录" class="headerlink" title="5. 备选配置记录"></a>5. 备选配置记录</h1><p>部署到nexus，除了在pom中添加部署插件，也可以以设置maven config文件的形式设置profile，配置方法记录如下：</p>
<h2 id="5-1-方式1"><a href="#5-1-方式1" class="headerlink" title="5.1. 方式1"></a>5.1. 方式1</h2><h3 id="5-1-1-设置私服地址，在节点之下增加"><a href="#5-1-1-设置私服地址，在节点之下增加" class="headerlink" title="5.1.1 设置私服地址，在节点之下增加"></a>5.1.1 设置私服地址，在<profiles>节点之下增加<profile></profile></profiles></h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>test<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>test<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>test<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 该 url 没有意义，可以随便写，但必须有。 --&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://*<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">releases</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">releases</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>test<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>local private nexus<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://ip:port/repository/maven-public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">releases</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">releases</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span>  </span><br><span class="line">         <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="5-1-2-激活配置"><a href="#5-1-2-激活配置" class="headerlink" title="5.1.2 激活配置"></a>5.1.2 激活配置</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activeProfiles</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">activeProfile</span>&gt;</span>test<span class="tag">&lt;/<span class="name">activeProfile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activeProfiles</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="5-2-方式2"><a href="#5-2-方式2" class="headerlink" title="5.2. 方式2"></a>5.2. 方式2</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>maven-releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://ip:port/repository/maven-releases/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">releases</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>maven-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://ip:port/repository/maven-snapshots/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">releases</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>maven-releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://ip:port/repository/maven-releases/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">releases</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>maven-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://ip:port/repository/maven-snapshots/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">releases</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://localhost:4000/2019/11/04/RESTful接口设计规范/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wanglv Yihua">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/default_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="iyihua">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/11/04/RESTful接口设计规范/" itemprop="url">
                  RESTful接口设计规范
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-11-04 15:53:35 / 修改时间：16:00:23" itemprop="dateCreated datePublished" datetime="2019-11-04T15:53:35+08:00">2019-11-04</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/design/" itemprop="url" rel="index"><span itemprop="name">design</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="RESTful-API-设计规范"><a href="#RESTful-API-设计规范" class="headerlink" title="RESTful API 设计规范"></a>RESTful API 设计规范</h1><p>RESTful API是目前比较成熟的一套互联网应用程序的API设计理论，是目前最流行的API设计规范，用于Web数据接口的设计。</p>
<p>什么是RESTful架构：</p>
<ul>
<li>（1）每一个URI代表一种资源；</li>
<li>（2）客户端和服务器之间，传递这种资源的某种表现层；</li>
<li>（3）客户端通过四个HTTP动词，对服务器端资源进行操作，实现”表现层状态转化”。</li>
</ul>
<h1 id="1-协议"><a href="#1-协议" class="headerlink" title="1. 协议"></a>1. 协议</h1><p>API与用户的通信协议，总是使用HTTPs协议。</p>
<h1 id="2-域名"><a href="#2-域名" class="headerlink" title="2. 域名"></a>2. 域名</h1><p>应该尽量将API部署在专用域名之下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://api.example.com</span><br></pre></td></tr></table></figure>
<p>如果确定API很简单，不会有进一步扩展，可以考虑放在主域名下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://example.org/api/</span><br></pre></td></tr></table></figure>
<h1 id="3-版本（Versioning）"><a href="#3-版本（Versioning）" class="headerlink" title="3. 版本（Versioning）"></a>3. 版本（Versioning）</h1><p>应该将API的版本号放入URL。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://api.example.com/v1/</span><br></pre></td></tr></table></figure>
<p>另一种做法是，将版本号放在HTTP头信息中，但不如放入URL方便和直观。Github采用这种做法。</p>
<h1 id="4-路径（Endpoint）"><a href="#4-路径（Endpoint）" class="headerlink" title="4. 路径（Endpoint）"></a>4. 路径（Endpoint）</h1><p>路径又称”终点”（endpoint），表示API的具体网址。</p>
<p>在RESTful架构中，每个网址代表一种资源（resource），所以网址中不能有动词，只能有名词，而且所用的名词往往与数据库的表格名对应。一般来说，数据库中的表都是同种记录的”集合”（collection），所以API中的名词也应该使用复数。</p>
<p>举例来说，有一个API提供动物园（zoo）的信息，还包括各种动物和雇员的信息，则它的路径应该设计成下面这样。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://api.example.com/v1/zoos</span><br><span class="line">https://api.example.com/v1/animals</span><br><span class="line">https://api.example.com/v1/employees</span><br></pre></td></tr></table></figure></p>
<p>而下面的 URL 不是名词，所以都是错误的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/getAllCars</span><br><span class="line">/createNewCar</span><br><span class="line">/deleteAllRedCars</span><br></pre></td></tr></table></figure></p>
<h1 id="5-HTTP动词"><a href="#5-HTTP动词" class="headerlink" title="5. HTTP动词"></a>5. HTTP动词</h1><p>对于资源的具体操作类型，由HTTP动词表示。</p>
<p>常用的HTTP动词有下面五个（括号里是对应的SQL命令）。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET（SELECT）：从服务器取出资源（一项或多项）。</span><br><span class="line">POST（CREATE）：在服务器新建一个资源。</span><br><span class="line">PUT（UPDATE）：在服务器更新资源（客户端提供改变后的完整资源）。</span><br><span class="line">PATCH（UPDATE）：在服务器更新资源（客户端提供改变的属性）。</span><br><span class="line">DELETE（DELETE）：从服务器删除资源。</span><br></pre></td></tr></table></figure></p>
<p>还有两个不常用的HTTP动词。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HEAD：获取资源的元数据。</span><br><span class="line">OPTIONS：获取信息，关于资源的哪些属性是客户端可以改变的。</span><br></pre></td></tr></table></figure></p>
<p>下面是一些例子。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /zoos：列出所有动物园</span><br><span class="line">POST /zoos：新建一个动物园</span><br><span class="line">GET /zoos/ID：获取某个指定动物园的信息</span><br><span class="line">PUT /zoos/ID：更新某个指定动物园的信息（提供该动物园的全部信息）</span><br><span class="line">PATCH /zoos/ID：更新某个指定动物园的信息（提供该动物园的部分信息）</span><br><span class="line">DELETE /zoos/ID：删除某个动物园</span><br><span class="line">GET /zoos/ID/animals：列出某个指定动物园的所有动物</span><br><span class="line">DELETE /zoos/ID/animals/ID：删除某个指定动物园的指定动物</span><br></pre></td></tr></table></figure></p>
<h1 id="6-过滤信息（Filtering）"><a href="#6-过滤信息（Filtering）" class="headerlink" title="6. 过滤信息（Filtering）"></a>6. 过滤信息（Filtering）</h1><p>如果记录数量很多，服务器不可能都将它们返回给用户。API应该提供参数，过滤返回结果。</p>
<p>下面是一些常见的参数。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?limit=10：指定返回记录的数量</span><br><span class="line">?offset=10：指定返回记录的开始位置。</span><br><span class="line">?page=2&amp;per_page=100：指定第几页，以及每页的记录数。</span><br><span class="line">?sortby=name&amp;order=asc：指定返回结果按照哪个属性排序，以及排序顺序。</span><br><span class="line">?animal_type_id=1：指定筛选条件</span><br></pre></td></tr></table></figure></p>
<p>参数的设计允许存在冗余，即允许API路径和URL参数偶尔有重复。比如，GET /zoo/ID/animals 与 GET /animals?zoo_id=ID 的含义是相同的。</p>
<h1 id="7-状态码（Status-Codes）"><a href="#7-状态码（Status-Codes）" class="headerlink" title="7. 状态码（Status Codes）"></a>7. 状态码（Status Codes）</h1><p>服务器向用户返回的状态码和提示信息，常见的有以下一些（方括号中是该状态码对应的HTTP动词）。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">200 OK - [GET]：服务器成功返回用户请求的数据，该操作是幂等的（Idempotent）。</span><br><span class="line">201 CREATED - [POST/PUT/PATCH]：用户新建或修改数据成功。</span><br><span class="line">202 Accepted - [*]：表示一个请求已经进入后台排队（异步任务）</span><br><span class="line">204 NO CONTENT - [DELETE]：用户删除数据成功。</span><br><span class="line">400 INVALID REQUEST - [POST/PUT/PATCH]：用户发出的请求有错误，服务器没有进行新建或修改数据的操作，该操作是幂等的。</span><br><span class="line">401 Unauthorized - [*]：表示用户没有权限（令牌、用户名、密码错误）。</span><br><span class="line">403 Forbidden - [*] 表示用户得到授权（与401错误相对），但是访问是被禁止的。</span><br><span class="line">404 NOT FOUND - [*]：用户发出的请求针对的是不存在的记录，服务器没有进行操作，该操作是幂等的。</span><br><span class="line">406 Not Acceptable - [GET]：用户请求的格式不可得（比如用户请求JSON格式，但是只有XML格式）。</span><br><span class="line">410 Gone -[GET]：用户请求的资源被永久删除，且不会再得到的。</span><br><span class="line">422 Unprocesable entity - [POST/PUT/PATCH] 当创建一个对象时，发生一个验证错误。</span><br><span class="line">500 INTERNAL SERVER ERROR - [*]：服务器发生错误，用户将无法判断发出的请求是否成功。</span><br><span class="line">状态码的完全列表参见这里。</span><br></pre></td></tr></table></figure></p>
<h1 id="8-错误处理（Error-handling）"><a href="#8-错误处理（Error-handling）" class="headerlink" title="8. 错误处理（Error handling）"></a>8. 错误处理（Error handling）</h1><p>如果状态码是4xx，就应该向用户返回出错信息。一般来说，返回的信息中将error作为键名，出错信息作为键值即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    error: &quot;Invalid API key&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="9-返回结果"><a href="#9-返回结果" class="headerlink" title="9. 返回结果"></a>9. 返回结果</h1><p>针对不同操作，服务器向用户返回的结果应该符合以下规范。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET /collection：返回资源对象的列表（数组）</span><br><span class="line">GET /collection/resource：返回单个资源对象</span><br><span class="line">POST /collection：返回新生成的资源对象</span><br><span class="line">PUT /collection/resource：返回完整的资源对象</span><br><span class="line">PATCH /collection/resource：返回完整的资源对象</span><br><span class="line">DELETE /collection/resource：返回一个空文档</span><br></pre></td></tr></table></figure></p>
<h1 id="10-Hypermedia-API"><a href="#10-Hypermedia-API" class="headerlink" title="10. Hypermedia API"></a>10. Hypermedia API</h1><p>RESTful API最好做到Hypermedia，即返回结果中提供链接，连向其他API方法，使得用户不查文档，也知道下一步应该做什么。</p>
<p>比如，当用户向api.example.com的根目录发出请求，会得到这样一个文档。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;link&quot;: &#123;</span><br><span class="line">  &quot;rel&quot;:   &quot;collection https://www.example.com/zoos&quot;,</span><br><span class="line">  &quot;href&quot;:  &quot;https://api.example.com/zoos&quot;,</span><br><span class="line">  &quot;title&quot;: &quot;List of zoos&quot;,</span><br><span class="line">  &quot;type&quot;:  &quot;application/vnd.yourformat+json&quot;</span><br><span class="line">&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>上面代码表示，文档中有一个link属性，用户读取这个属性就知道下一步该调用什么API了。rel表示这个API与当前网址的关系（collection关系，并给出该collection的网址），href表示API的路径，title表示API的标题，type表示返回类型。</p>
<p>Hypermedia API的设计被称为HATEOAS。Github的API就是这种设计，访问api.github.com会得到一个所有可用API的网址列表。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;current_user_url&quot;: &quot;https://api.github.com/user&quot;,</span><br><span class="line">  &quot;authorizations_url&quot;: &quot;https://api.github.com/authorizations&quot;,</span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从上面可以看到，如果想获取当前用户的信息，应该去访问api.github.com/user，然后就得到了下面结果。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;message&quot;: &quot;Requires authentication&quot;,</span><br><span class="line">  &quot;documentation_url&quot;: &quot;https://developer.github.com/v3&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面代码表示，服务器给出了提示信息，以及文档的网址。</p>
<h1 id="11-RESTful-API-最佳实践"><a href="#11-RESTful-API-最佳实践" class="headerlink" title="11. RESTful API 最佳实践"></a>11. RESTful API 最佳实践</h1><h2 id="11-1-URL-设计，动词的覆盖"><a href="#11-1-URL-设计，动词的覆盖" class="headerlink" title="11.1. URL 设计，动词的覆盖"></a>11.1. URL 设计，动词的覆盖</h2><p>有些客户端只能使用GET和POST这两种方法。服务器必须接受POST模拟其他三个方法（PUT、PATCH、DELETE）。</p>
<p>这时，客户端发出的 HTTP 请求，要加上X-HTTP-Method-Override属性，告诉服务器应该使用哪一个动词，覆盖POST方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST /api/Person/4 HTTP/1.1  </span><br><span class="line">X-HTTP-Method-Override: PUT</span><br></pre></td></tr></table></figure>
<p>上面代码中，X-HTTP-Method-Override指定本次请求的方法是PUT，而不是POST。</p>
<h2 id="11-2-避免多级-URL"><a href="#11-2-避免多级-URL" class="headerlink" title="11.2. 避免多级 URL"></a>11.2. 避免多级 URL</h2><p>常见的情况是，资源需要多级分类，因此很容易写出多级的 URL，比如获取某个作者的某一类文章。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /authors/12/categories/2</span><br></pre></td></tr></table></figure></p>
<p>这种 URL 不利于扩展，语义也不明确，往往要想一会，才能明白含义。</p>
<p>更好的做法是，除了第一级，其他级别都用查询字符串表达。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /authors/12?categories=2</span><br></pre></td></tr></table></figure></p>
<p>下面是另一个例子，查询已发布的文章。你可能会设计成下面的 URL。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /articles/published</span><br></pre></td></tr></table></figure></p>
<p>查询字符串的写法明显更好。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /articles?published=true</span><br></pre></td></tr></table></figure></p>
<h2 id="11-3-状态码"><a href="#11-3-状态码" class="headerlink" title="11.3. 状态码"></a>11.3. 状态码</h2><h3 id="11-3-1-状态码必须精确"><a href="#11-3-1-状态码必须精确" class="headerlink" title="11.3.1 状态码必须精确"></a>11.3.1 状态码必须精确</h3><p>客户端的每一次请求，服务器都必须给出回应。回应包括 HTTP 状态码和数据两部分。</p>
<p>HTTP 状态码就是一个三位数，分成五个类别。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1xx：相关信息</span><br><span class="line">2xx：操作成功</span><br><span class="line">3xx：重定向</span><br><span class="line">4xx：客户端错误</span><br><span class="line">5xx：服务器错误</span><br></pre></td></tr></table></figure></p>
<p>这五大类总共包含100多种状态码，覆盖了绝大部分可能遇到的情况。每一种状态码都有标准的（或者约定的）解释，客户端只需查看状态码，就可以判断出发生了什么情况，所以服务器应该返回尽可能精确的状态码。</p>
<p>API 不需要1xx状态码，下面介绍其他四类状态码的精确含义。</p>
<h3 id="11-3-2-2xx-状态码"><a href="#11-3-2-2xx-状态码" class="headerlink" title="11.3.2 2xx 状态码"></a>11.3.2 2xx 状态码</h3><p>200状态码表示操作成功，但是不同的方法可以返回更精确的状态码。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET: 200 OK</span><br><span class="line">POST: 201 Created</span><br><span class="line">PUT: 200 OK</span><br><span class="line">PATCH: 200 OK</span><br><span class="line">DELETE: 204 No Content</span><br></pre></td></tr></table></figure></p>
<p>上面代码中，POST返回201状态码，表示生成了新的资源；DELETE返回204状态码，表示资源已经不存在。</p>
<p>此外，202 Accepted状态码表示服务器已经收到请求，但还未进行处理，会在未来再处理，通常用于异步操作。下面是一个例子。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 202 Accepted</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;task&quot;: &#123;</span><br><span class="line">    &quot;href&quot;: &quot;/api/company/job-management/jobs/2130040&quot;,</span><br><span class="line">    &quot;id&quot;: &quot;2130040&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="11-3-3-3xx-状态码"><a href="#11-3-3-3xx-状态码" class="headerlink" title="11.3.3 3xx 状态码"></a>11.3.3 3xx 状态码</h3><p>API 用不到301状态码（永久重定向）和302状态码（暂时重定向，307也是这个含义），因为它们可以由应用级别返回，浏览器会直接跳转，API 级别可以不考虑这两种情况。</p>
<p>API 用到的3xx状态码，主要是303 See Other，表示参考另一个 URL。它与302和307的含义一样，也是”暂时重定向”，区别在于302和307用于GET请求，而303用于POST、PUT和DELETE请求。收到303以后，浏览器不会自动跳转，而会让用户自己决定下一步怎么办。下面是一个例子。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 303 See Other</span><br><span class="line">Location: /api/orders/12345</span><br></pre></td></tr></table></figure>
<h3 id="11-3-4-4xx-状态码"><a href="#11-3-4-4xx-状态码" class="headerlink" title="11.3.4 4xx 状态码"></a>11.3.4 4xx 状态码</h3><p>4xx状态码表示客户端错误，主要有下面几种。</p>
<ul>
<li>400 Bad Request：服务器不理解客户端的请求，未做任何处理。</li>
<li>401 Unauthorized：用户未提供身份验证凭据，或者没有通过身份验证。</li>
<li>403 Forbidden：用户通过了身份验证，但是不具有访问资源所需的权限。</li>
<li>404 Not Found：所请求的资源不存在，或不可用。</li>
<li>405 Method Not Allowed：用户已经通过身份验证，但是所用的 HTTP 方法不在他的权限之内。</li>
<li>410 Gone：所请求的资源已从这个地址转移，不再可用。</li>
<li>415 Unsupported Media Type：客户端要求的返回格式不支持。比如，API 只能返回 JSON 格式，但是客户端要求返回 XML 格式。</li>
<li>422 Unprocessable Entity ：客户端上传的附件无法处理，导致请求失败。</li>
<li>429 Too Many Requests：客户端的请求次数超过限额。</li>
</ul>
<h3 id="11-3-5-5xx-状态码"><a href="#11-3-5-5xx-状态码" class="headerlink" title="11.3.5 5xx 状态码"></a>11.3.5 5xx 状态码</h3><p>5xx状态码表示服务端错误。一般来说，API不会向用户透露服务器的详细信息，所以只要两个状态码就够了。</p>
<ul>
<li>500 Internal Server Error：客户端请求有效，服务器处理时发生了意外。</li>
<li>503 Service Unavailable：服务器无法处理请求，一般用于网站维护状态。</li>
</ul>
<h2 id="11-4-服务器回应"><a href="#11-4-服务器回应" class="headerlink" title="11.4. 服务器回应"></a>11.4. 服务器回应</h2><h3 id="11-4-1-不要返回纯本文"><a href="#11-4-1-不要返回纯本文" class="headerlink" title="11.4.1 不要返回纯本文"></a>11.4.1 不要返回纯本文</h3><p>API 返回的数据格式，不应该是纯文本，而应该是一个 JSON 对象，因为这样才能返回标准的结构化数据。所以，服务器回应的 HTTP 头的Content-Type属性要设为application/json。</p>
<p>客户端请求时，也要明确告诉服务器，可以接受 JSON 格式，即请求的 HTTP 头的ACCEPT属性也要设成application/json。下面是一个例子。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /orders/2 HTTP/1.1 </span><br><span class="line">Accept: application/json</span><br></pre></td></tr></table></figure>
<h3 id="11-4-2-发生错误时，不要返回-200-状态码"><a href="#11-4-2-发生错误时，不要返回-200-状态码" class="headerlink" title="11.4.2 发生错误时，不要返回 200 状态码"></a>11.4.2 发生错误时，不要返回 200 状态码</h3><p>有一种不恰当的做法是，即使发生错误，也返回200状态码，把错误信息放在数据体里面，就像下面这样。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;status&quot;: &quot;failure&quot;,</span><br><span class="line">  &quot;data&quot;: &#123;</span><br><span class="line">    &quot;error&quot;: &quot;Expected at least two items in list.&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面代码中，解析数据体以后，才能得知操作失败。</p>
<p>这张做法实际上取消了状态码，这是完全不可取的。正确的做法是，状态码反映发生的错误，具体的错误信息放在数据体里面返回。下面是一个例子。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 400 Bad Request</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;error&quot;: &quot;Invalid payoad.&quot;,</span><br><span class="line">  &quot;detail&quot;: &#123;</span><br><span class="line">     &quot;surname&quot;: &quot;This field is required.&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="参考资料："><a href="#参考资料：" class="headerlink" title="参考资料："></a>参考资料：</h1><ul>
<li>RESTful API 设计指南：<a href="http://www.ruanyifeng.com/blog/2014/05/restful_api.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2014/05/restful_api.html</a></li>
<li>RESTful API 最佳实践：<a href="http://www.ruanyifeng.com/blog/2018/10/restful-api-best-practices.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2018/10/restful-api-best-practices.html</a></li>
<li>Learn REST: A RESTful Tutorial：<a href="https://www.restapitutorial.com/" target="_blank" rel="noopener">https://www.restapitutorial.com/</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://localhost:4000/2019/11/04/java后端项目开发规范/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wanglv Yihua">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/default_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="iyihua">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/11/04/java后端项目开发规范/" itemprop="url">
                  java后端项目开发规范
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-11-04 15:49:28 / 修改时间：15:51:30" itemprop="dateCreated datePublished" datetime="2019-11-04T15:49:28+08:00">2019-11-04</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/manager/" itemprop="url" rel="index"><span itemprop="name">manager</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="一-mysql数据库"><a href="#一-mysql数据库" class="headerlink" title="一. mysql数据库"></a>一. mysql数据库</h1><h2 id="（一）建表约定"><a href="#（一）建表约定" class="headerlink" title="（一）建表约定"></a>（一）建表约定</h2><h3 id="1-【强制】表名、字段名必须使用小写字母或数字，禁止出现数字开头，禁止两个下划线中间只出现数字。数据库字段名的修改代价很大，因为无法进行预发布，所以字段名称需要慎重考虑。"><a href="#1-【强制】表名、字段名必须使用小写字母或数字，禁止出现数字开头，禁止两个下划线中间只出现数字。数据库字段名的修改代价很大，因为无法进行预发布，所以字段名称需要慎重考虑。" class="headerlink" title="1.【强制】表名、字段名必须使用小写字母或数字，禁止出现数字开头，禁止两个下划线中间只出现数字。数据库字段名的修改代价很大，因为无法进行预发布，所以字段名称需要慎重考虑。"></a>1.【强制】表名、字段名必须使用小写字母或数字，禁止出现数字开头，禁止两个下划线中间只出现数字。数据库字段名的修改代价很大，因为无法进行预发布，所以字段名称需要慎重考虑。</h3><p>说明：MySQL 在 Windows 下不区分大小写，但在 Linux下默认是区分大小写。因此，数据库名、表名、字段名，都不允许出现任何大写字母，避免节外生枝。</p>
<p>正例：aliyun_admin，rdc_config，level3_name</p>
<p>反例：AliyunAdmin，rdcConfig，level_3_name</p>
<h3 id="2-【强制】小数类型为-decimal，在需要精确经度的时候禁止使用-float和double。"><a href="#2-【强制】小数类型为-decimal，在需要精确经度的时候禁止使用-float和double。" class="headerlink" title="2.【强制】小数类型为 decimal，在需要精确经度的时候禁止使用 float和double。"></a>2.【强制】小数类型为 decimal，在需要精确经度的时候禁止使用 float和double。</h3><p>说明：float 和 double在存储的时候，存在精度损失的问题，很可能在值的比较时，得到不正确的结果。如果存储的数据范围超过decimal的范围，建议将数据拆成整数和小数分开存储。</p>
<h3 id="3-【强制】表示状态类型等的数字可枚举类的字段，数据类型应该使用tinyint。如果字段为非负数，数据类型是unsigned-tinyint"><a href="#3-【强制】表示状态类型等的数字可枚举类的字段，数据类型应该使用tinyint。如果字段为非负数，数据类型是unsigned-tinyint" class="headerlink" title="3.【强制】表示状态类型等的数字可枚举类的字段，数据类型应该使用tinyint。如果字段为非负数，数据类型是unsigned tinyint."></a>3.【强制】表示状态类型等的数字可枚举类的字段，数据类型应该使用tinyint。如果字段为非负数，数据类型是unsigned tinyint.</h3><p>说明：任何字段如果为非负数，必须是 unsigned。</p>
<h3 id="4-【强制】表名不使用复数名词"><a href="#4-【强制】表名不使用复数名词" class="headerlink" title="4.【强制】表名不使用复数名词"></a>4.【强制】表名不使用复数名词</h3><h3 id="5-【强制】主键索引名为-pk-字段名；唯一索引名为-uk-字段名；普通索引名则为-idx-字段名。"><a href="#5-【强制】主键索引名为-pk-字段名；唯一索引名为-uk-字段名；普通索引名则为-idx-字段名。" class="headerlink" title="5.【强制】主键索引名为 pk_字段名；唯一索引名为 uk_字段名；普通索引名则为 idx_字段名。"></a>5.【强制】主键索引名为 pk_字段名；唯一索引名为 uk_字段名；普通索引名则为 idx_字段名。</h3><p>说明：pk_ 即 primary key；uk_ 即 unique key；idx_ 即 index 的简称。</p>
<h3 id="6-【强制】如果存储的字符串长度几乎相等，使用-char定长字符串类型。"><a href="#6-【强制】如果存储的字符串长度几乎相等，使用-char定长字符串类型。" class="headerlink" title="6.【强制】如果存储的字符串长度几乎相等，使用 char定长字符串类型。"></a>6.【强制】如果存储的字符串长度几乎相等，使用 char定长字符串类型。</h3><h3 id="7-【强制】varchar是可变长字符串，不预先分配存储空间，长度不要超过-5000，如果存储长度大于此值，定义字段类型为-text，独立出来一张表，用主键来对应，避免影响其它字段索引效率。"><a href="#7-【强制】varchar是可变长字符串，不预先分配存储空间，长度不要超过-5000，如果存储长度大于此值，定义字段类型为-text，独立出来一张表，用主键来对应，避免影响其它字段索引效率。" class="headerlink" title="7.【强制】varchar是可变长字符串，不预先分配存储空间，长度不要超过 5000，如果存储长度大于此值，定义字段类型为 text，独立出来一张表，用主键来对应，避免影响其它字段索引效率。"></a>7.【强制】varchar是可变长字符串，不预先分配存储空间，长度不要超过 5000，如果存储长度大于此值，定义字段类型为 text，独立出来一张表，用主键来对应，避免影响其它字段索引效率。</h3><h3 id="8-【推荐】表的命名最好是加上“业务名称-表的作用”。"><a href="#8-【推荐】表的命名最好是加上“业务名称-表的作用”。" class="headerlink" title="8.【推荐】表的命名最好是加上“业务名称_表的作用”。"></a>8.【推荐】表的命名最好是加上“业务名称_表的作用”。</h3><h3 id="9-【推荐】字段允许适当冗余，以提高查询性能，但必须考虑数据一致。"><a href="#9-【推荐】字段允许适当冗余，以提高查询性能，但必须考虑数据一致。" class="headerlink" title="9.【推荐】字段允许适当冗余，以提高查询性能，但必须考虑数据一致。"></a>9.【推荐】字段允许适当冗余，以提高查询性能，但必须考虑数据一致。</h3><p>冗余字段应遵循：</p>
<p>&emsp;1）不是频繁修改的字段。</p>
<p>&emsp;2）不是 varchar 超长字段，更不能是 text 字段。</p>
<p>正例：商品类目名称使用频率高，字段长度短，名称基本一成不变，可在相关联的表中冗余存储类目名称，避免关联查询。</p>
<h2 id="（二）索引约定"><a href="#（二）索引约定" class="headerlink" title="（二）索引约定"></a>（二）索引约定</h2><h3 id="1-【强制】超过三个表禁止-join。需要join的字段，数据类型必须绝对一致；多表关联查询时，保证被关联的字段需要有索引。"><a href="#1-【强制】超过三个表禁止-join。需要join的字段，数据类型必须绝对一致；多表关联查询时，保证被关联的字段需要有索引。" class="headerlink" title="1.【强制】超过三个表禁止 join。需要join的字段，数据类型必须绝对一致；多表关联查询时，保证被关联的字段需要有索引。"></a>1.【强制】超过三个表禁止 join。需要join的字段，数据类型必须绝对一致；多表关联查询时，保证被关联的字段需要有索引。</h3><p>说明：即使双表 join 也要注意表索引、SQL 性能。</p>
<h3 id="2-【强制】在varchar字段上建立索引时，必须指定索引长度，没必要对全字段建立索引，根据实际文本区分度决定索引长度即可。"><a href="#2-【强制】在varchar字段上建立索引时，必须指定索引长度，没必要对全字段建立索引，根据实际文本区分度决定索引长度即可。" class="headerlink" title="2.【强制】在varchar字段上建立索引时，必须指定索引长度，没必要对全字段建立索引，根据实际文本区分度决定索引长度即可。"></a>2.【强制】在varchar字段上建立索引时，必须指定索引长度，没必要对全字段建立索引，根据实际文本区分度决定索引长度即可。</h3><p>说明：索引的长度与区分度是一对矛盾体，一般对字符串类型数据，长度为 20 的索引，区分度会高达 90%以上，可以使用 count(distinct left(列名, 索引长度))/count(*)的区分度<br>来确定。</p>
<h3 id="3-【推荐】页面搜索严禁左模糊或者全模糊，如果需要请走搜索引擎来解决。"><a href="#3-【推荐】页面搜索严禁左模糊或者全模糊，如果需要请走搜索引擎来解决。" class="headerlink" title="3.【推荐】页面搜索严禁左模糊或者全模糊，如果需要请走搜索引擎来解决。"></a>3.【推荐】页面搜索严禁左模糊或者全模糊，如果需要请走搜索引擎来解决。</h3><p>说明：索引文件具有B-Tree的最左前缀匹配特性，如果左边的值未确定，那么无法使用此索<br>引。</p>
<h3 id="4-【推荐】如果有-order-by的场景，请注意利用索引的有序性。order-by最后的字段是组合索引的一部分，并且放在索引组合顺序的最后，避免出现-file-sort-的情况，影响查询性能。"><a href="#4-【推荐】如果有-order-by的场景，请注意利用索引的有序性。order-by最后的字段是组合索引的一部分，并且放在索引组合顺序的最后，避免出现-file-sort-的情况，影响查询性能。" class="headerlink" title="4.【推荐】如果有 order by的场景，请注意利用索引的有序性。order by最后的字段是组合索引的一部分，并且放在索引组合顺序的最后，避免出现 file_sort 的情况，影响查询性能。"></a>4.【推荐】如果有 order by的场景，请注意利用索引的有序性。order by最后的字段是组合索引的一部分，并且放在索引组合顺序的最后，避免出现 file_sort 的情况，影响查询性能。</h3><p>正例：where a=? and b=? order by c; 索引：a_b_c</p>
<p>反例：索引中有范围查找，那么索引有序性无法利用，如：WHERE a&gt;10 ORDER BY b; 索引<br>a_b 无法排序。</p>
<h3 id="5-【推荐】利用延迟关联或者子查询优化超多分页场景。"><a href="#5-【推荐】利用延迟关联或者子查询优化超多分页场景。" class="headerlink" title="5.【推荐】利用延迟关联或者子查询优化超多分页场景。"></a>5.【推荐】利用延迟关联或者子查询优化超多分页场景。</h3><p>说明：MySQL 并不是跳过 offset 行，而是取 offset+N 行，然后返回放弃前 offset 行，返回N行，那当offset特别大的时候，效率就非常的低下，要么控制返回的总页数，要么对超过特定阈值的页数进行 SQL 改写。</p>
<p>正例：先快速定位需要获取的 id 段，然后再关联：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT a.* FROM 表 1 a, (select id from 表 1 where 条件 LIMIT 100000,20 ) b where a.id=b.id</span><br></pre></td></tr></table></figure></p>
<h3 id="6-【推荐】建组合索引的时候，区分度最高的在最左边。"><a href="#6-【推荐】建组合索引的时候，区分度最高的在最左边。" class="headerlink" title="6.【推荐】建组合索引的时候，区分度最高的在最左边。"></a>6.【推荐】建组合索引的时候，区分度最高的在最左边。</h3><p>正例：如果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">where a=? and b=?</span><br></pre></td></tr></table></figure></p>
<p>，a列的几乎接近于唯一值，那么只需要单建idx_a索引即可。</p>
<p>说明：存在非等号和等号混合判断条件时，在建索引时，请把等号条件的列前置。如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">where a&gt;?and b=?</span><br></pre></td></tr></table></figure></p>
<p>那么即使 a 的区分度更高，也必须把 b 放在索引的最前列。</p>
<h2 id="三-SQL语句约定"><a href="#三-SQL语句约定" class="headerlink" title="(三)SQL语句约定"></a>(三)SQL语句约定</h2><h3 id="1-【强制】不得使用外键与级联，一切外键概念必须在应用层解决。"><a href="#1-【强制】不得使用外键与级联，一切外键概念必须在应用层解决。" class="headerlink" title="1.【强制】不得使用外键与级联，一切外键概念必须在应用层解决。"></a>1.【强制】不得使用外键与级联，一切外键概念必须在应用层解决。</h3><p>说明：以学生和成绩的关系为例，学生表中的student_id是主键，那么成绩表中的student_id则为外键。如果更新学生表中的 student_id，同时触发成绩表中的 student_id 更新，即为级联更新。外键与级联更新适用于单机低并发，不适合分布式、高并发集群；级联更新是强阻塞，存在数据库更新风暴的风险；外键影响数据库的插入速度。</p>
<h3 id="2-【强制】不要使用-count-列名-或-count-常量-来替代-count-，count-是-SQL92-定义的标准统计行数的语法，跟数据库无关，跟-NULL-和非-NULL-无关。"><a href="#2-【强制】不要使用-count-列名-或-count-常量-来替代-count-，count-是-SQL92-定义的标准统计行数的语法，跟数据库无关，跟-NULL-和非-NULL-无关。" class="headerlink" title="2.【强制】不要使用 count(列名)或 count(常量)来替代 count()，count()是 SQL92 定义的标准统计行数的语法，跟数据库无关，跟 NULL 和非 NULL 无关。"></a>2.【强制】不要使用 count(列名)或 count(常量)来替代 count(<em>)，count(</em>)是 SQL92 定义的标准统计行数的语法，跟数据库无关，跟 NULL 和非 NULL 无关。</h3><p>说明：count(*)会统计值为 NULL 的行，而 count(列名)不会统计此列为 NULL 值的行。</p>
<h3 id="3-【强制】当某一列的值全是-NULL-时，count-col-的返回结果为-0，但-sum-col-的返回结果为NULL，因此使用-sum-时需注意-NPE-问题。"><a href="#3-【强制】当某一列的值全是-NULL-时，count-col-的返回结果为-0，但-sum-col-的返回结果为NULL，因此使用-sum-时需注意-NPE-问题。" class="headerlink" title="3.【强制】当某一列的值全是 NULL 时，count(col)的返回结果为 0，但 sum(col)的返回结果为NULL，因此使用 sum()时需注意 NPE 问题。"></a>3.【强制】当某一列的值全是 NULL 时，count(col)的返回结果为 0，但 sum(col)的返回结果为NULL，因此使用 sum()时需注意 NPE 问题。</h3><p>正例：可以使用如下方式来避免 sum 的 NPE 问题：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT IF(ISNULL(SUM(g)),0,SUM(g)) FROM table;</span><br></pre></td></tr></table></figure></p>
<h3 id="4-【强制】在代码中写分页查询逻辑时，若-count-为-0-应直接返回，避免执行后面的分页语句。"><a href="#4-【强制】在代码中写分页查询逻辑时，若-count-为-0-应直接返回，避免执行后面的分页语句。" class="headerlink" title="4.【强制】在代码中写分页查询逻辑时，若 count 为 0 应直接返回，避免执行后面的分页语句。"></a>4.【强制】在代码中写分页查询逻辑时，若 count 为 0 应直接返回，避免执行后面的分页语句。</h3><h3 id="5-【强制】禁止使用存储过程，存储过程难以调试和扩展，更没有移植性。"><a href="#5-【强制】禁止使用存储过程，存储过程难以调试和扩展，更没有移植性。" class="headerlink" title="5.【强制】禁止使用存储过程，存储过程难以调试和扩展，更没有移植性。"></a>5.【强制】禁止使用存储过程，存储过程难以调试和扩展，更没有移植性。</h3><h3 id="6-【强制】数据订正时，删除和修改记录时，要先-select，避免出现误删除，确认无误才能执"><a href="#6-【强制】数据订正时，删除和修改记录时，要先-select，避免出现误删除，确认无误才能执" class="headerlink" title="6.【强制】数据订正时，删除和修改记录时，要先 select，避免出现误删除，确认无误才能执"></a>6.【强制】数据订正时，删除和修改记录时，要先 select，避免出现误删除，确认无误才能执</h3><p>行更新语句。</p>
<h3 id="7-【推荐】in-操作能避免则避免，若实在避免不了，需要仔细评估-in-后边的集合元素数量，控"><a href="#7-【推荐】in-操作能避免则避免，若实在避免不了，需要仔细评估-in-后边的集合元素数量，控" class="headerlink" title="7.【推荐】in 操作能避免则避免，若实在避免不了，需要仔细评估 in 后边的集合元素数量，控"></a>7.【推荐】in 操作能避免则避免，若实在避免不了，需要仔细评估 in 后边的集合元素数量，控</h3><p>制在 1000 个之内。</p>
<h3 id="8-【参考】如果有全球化需要，所有的字符存储与表示，均以-utf-8-编码，注意字符统计函数的区别。"><a href="#8-【参考】如果有全球化需要，所有的字符存储与表示，均以-utf-8-编码，注意字符统计函数的区别。" class="headerlink" title="8.【参考】如果有全球化需要，所有的字符存储与表示，均以 utf-8 编码，注意字符统计函数的区别。"></a>8.【参考】如果有全球化需要，所有的字符存储与表示，均以 utf-8 编码，注意字符统计函数的区别。</h3><p>说明：</p>
<ul>
<li>SELECT LENGTH(“轻松工作”)； 返回为 12</li>
<li>SELECT CHARACTER_LENGTH(“轻松工作”)； 返回为 4</li>
</ul>
<p>如果需要存储表情，那么选择 utfmb4 来进行存储，注意它与 utf-8 编码的区别。</p>
<h2 id="四-ORM-映射"><a href="#四-ORM-映射" class="headerlink" title="(四)ORM 映射"></a>(四)ORM 映射</h2><h3 id="1-【强制】在表查询中，一律不要使用-作为查询的字段列表，需要哪些字段必须明确写明。"><a href="#1-【强制】在表查询中，一律不要使用-作为查询的字段列表，需要哪些字段必须明确写明。" class="headerlink" title="1.【强制】在表查询中，一律不要使用 *作为查询的字段列表，需要哪些字段必须明确写明。"></a>1.【强制】在表查询中，一律不要使用 *作为查询的字段列表，需要哪些字段必须明确写明。</h3><p>说明：</p>
<pre><code>1）增加查询分析器解析成本。
2）增减字段容易与 resultMap 配置不一致。
</code></pre><h3 id="2-【强制】不要用-resultClass-当返回参数，即使所有类属性名与数据库字段一一对应，也需要定义；反过来，每一个表也必然有一个与之对应。"><a href="#2-【强制】不要用-resultClass-当返回参数，即使所有类属性名与数据库字段一一对应，也需要定义；反过来，每一个表也必然有一个与之对应。" class="headerlink" title="2.【强制】不要用 resultClass 当返回参数，即使所有类属性名与数据库字段一一对应，也需要定义；反过来，每一个表也必然有一个与之对应。"></a>2.【强制】不要用 resultClass 当返回参数，即使所有类属性名与数据库字段一一对应，也需要定义；反过来，每一个表也必然有一个与之对应。</h3><p>说明：配置映射关系，使字段与 DO 类解耦，方便维护。</p>
<h3 id="3-【强制】sql-xml-配置参数使用：-，-param-不要使用-此种方式容易出现-SQL-注入。"><a href="#3-【强制】sql-xml-配置参数使用：-，-param-不要使用-此种方式容易出现-SQL-注入。" class="headerlink" title="3.【强制】sql.xml 配置参数使用：#{}，#param# 不要使用${} 此种方式容易出现 SQL 注入。"></a>3.【强制】sql.xml 配置参数使用：#{}，#param# 不要使用${} 此种方式容易出现 SQL 注入。</h3><h3 id="4-【推荐】不要直接拿-HashMap-与-Hashtable-作为查询结果集的输出。"><a href="#4-【推荐】不要直接拿-HashMap-与-Hashtable-作为查询结果集的输出。" class="headerlink" title="4.【推荐】不要直接拿 HashMap 与 Hashtable 作为查询结果集的输出。"></a>4.【推荐】不要直接拿 HashMap 与 Hashtable 作为查询结果集的输出。</h3><p>说明：resultClass=”Hashtable”，会置入字段名和属性值，但是值的类型不可控。</p>
<h3 id="5-【推荐】不要写一个大而全的数据更新接口。传入为-POJO类，不管是不是自己的目标更新字段，都进行-update-table-set-c1-value1-c2-value2-c3-value3-这是不对的。执行-SQL时，不要更新无改动的字段，一是易出错；二是效率低；三是增加binlog存储"><a href="#5-【推荐】不要写一个大而全的数据更新接口。传入为-POJO类，不管是不是自己的目标更新字段，都进行-update-table-set-c1-value1-c2-value2-c3-value3-这是不对的。执行-SQL时，不要更新无改动的字段，一是易出错；二是效率低；三是增加binlog存储" class="headerlink" title="5.【推荐】不要写一个大而全的数据更新接口。传入为 POJO类，不管是不是自己的目标更新字段，都进行 update table set c1=value1,c2=value2,c3=value3; 这是不对的。执行 SQL时，不要更新无改动的字段，一是易出错；二是效率低；三是增加binlog存储."></a>5.【推荐】不要写一个大而全的数据更新接口。传入为 POJO类，不管是不是自己的目标更新字段，都进行 update table set c1=value1,c2=value2,c3=value3; 这是不对的。执行 SQL时，不要更新无改动的字段，一是易出错；二是效率低；三是增加binlog存储.</h3><h1 id="2-工程结构"><a href="#2-工程结构" class="headerlink" title="2. 工程结构"></a>2. 工程结构</h1><h2 id="一-应用分层"><a href="#一-应用分层" class="headerlink" title="(一)应用分层"></a>(一)应用分层</h2><h3 id="1-【推荐】图中默认上层依赖于下层，箭头关系表示可直接依赖，如：开放接口层可以依赖于Web-层，也可以直接依赖于-Service-层，依此类推："><a href="#1-【推荐】图中默认上层依赖于下层，箭头关系表示可直接依赖，如：开放接口层可以依赖于Web-层，也可以直接依赖于-Service-层，依此类推：" class="headerlink" title="1. 【推荐】图中默认上层依赖于下层，箭头关系表示可直接依赖，如：开放接口层可以依赖于Web 层，也可以直接依赖于 Service 层，依此类推："></a>1. 【推荐】图中默认上层依赖于下层，箭头关系表示可直接依赖，如：开放接口层可以依赖于Web 层，也可以直接依赖于 Service 层，依此类推：</h3><p><img src="images/java-file-001.png" alt></p>
<ul>
<li><strong>开放接口层</strong>：可直接封装 Service 方法暴露成 RPC 接口；通过 Web 封装成 http 接口；进行网关安全控制、流量控制等。</li>
<li><strong>终端显示层</strong>：各个端的模板渲染并执行显示的层。当前主要是 velocity 渲染，JS 渲染，JSP 渲染，移动端展示等。</li>
<li><strong>Web层</strong>：主要是对访问控制进行转发，各类基本参数校验，或者不复用的业务简单处理等。</li>
<li><strong>Service 层</strong>：相对具体的业务逻辑服务层。</li>
<li><p><strong>Manager 层</strong>：通用业务处理层，它有如下特征：</p>
<p>  &emsp;1） 对第三方平台封装的层，预处理返回结果及转化异常信息；</p>
<p>  &emsp;2） 对 Service 层通用能力的下沉，如缓存方案、中间件通用处理；</p>
<p>  &emsp;3） 与 DAO 层交互，对多个 DAO 的组合复用。</p>
</li>
<li><strong>DAO 层</strong>：数据访问层，与底层 MySQL、Oracle、Hbase 等进行数据交互。<br> 外部接口或第三方平台：包括其它部门 RPC 开放接口，基础平台，其它公司的 HTTP 接口。</li>
</ul>
<h2 id="二-二方库依赖"><a href="#二-二方库依赖" class="headerlink" title="(二)二方库依赖"></a>(二)二方库依赖</h2><h3 id="1-【强制】定义-GAV-遵从以下规则："><a href="#1-【强制】定义-GAV-遵从以下规则：" class="headerlink" title="1. 【强制】定义 GAV 遵从以下规则："></a>1. 【强制】定义 GAV 遵从以下规则：</h3><p>&emsp;1） GroupID 格式：com.{公司/BU }.业务线.[子业务线]，最多 4 级。<br>说明：{公司/BU} 例如：alibaba/taobao/tmall/aliexpress 等 BU 一级；子业务线可选。<br>正例：com.taobao.jstorm 或 com.alibaba.dubbo.register</p>
<p>&emsp;2） ArtifactID 格式：产品线名-模块名。语义不重复不遗漏，先到中央仓库去查证一下。<br>正例：dubbo-client / fastjson-api / jstorm-tool</p>
<p>&emsp;3） Version：详细规定参考下方。</p>
<h3 id="2-【强制】二方库版本号命名方式：主版本号-次版本号-修订号"><a href="#2-【强制】二方库版本号命名方式：主版本号-次版本号-修订号" class="headerlink" title="2. 【强制】二方库版本号命名方式：主版本号.次版本号.修订号"></a>2. 【强制】二方库版本号命名方式：主版本号.次版本号.修订号</h3><p>&emsp;1） 主版本号：产品方向改变，或者大规模 API 不兼容，或者架构不兼容升级。</p>
<p>&emsp;2） 次版本号：保持相对兼容性，增加主要功能特性，影响范围极小的 API 不兼容修改。</p>
<p>&emsp;3） 修订号：保持完全兼容性，修复 BUG、新增次要功能特性等。</p>
<p>说明：注意起始版本号必须为：1.0.0，而不是 0.0.1正式发布的类库必须先去中央仓库进<br>行查证，使版本号有延续性，正式版本号不允许覆盖升级。如当前版本：1.3.3，那么下一个合理的版本号：1.3.4 或 1.4.0 或 2.0.0</p>
<h3 id="3-【强制】线上应用不要依赖-SNAPSHOT-版本（安全包除外）。"><a href="#3-【强制】线上应用不要依赖-SNAPSHOT-版本（安全包除外）。" class="headerlink" title="3. 【强制】线上应用不要依赖 SNAPSHOT 版本（安全包除外）。"></a>3. 【强制】线上应用不要依赖 SNAPSHOT 版本（安全包除外）。</h3><p>说明：不依赖SNAPSHOT版本是保证应用发布的幂等性。另外，也可以加快编译时的打包构建。</p>
<h1 id="3-编程约定"><a href="#3-编程约定" class="headerlink" title="3. 编程约定"></a>3. 编程约定</h1>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://localhost:4000/2019/11/04/springboot-不同环境的编译打包运行/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wanglv Yihua">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/default_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="iyihua">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/11/04/springboot-不同环境的编译打包运行/" itemprop="url">
                  springboot-不同环境的编译打包运行
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-11-04 15:20:13 / 修改时间：15:27:12" itemprop="dateCreated datePublished" datetime="2019-11-04T15:20:13+08:00">2019-11-04</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/java-spring/" itemprop="url" rel="index"><span itemprop="name">java-spring</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="不同环境的编译打包运行"><a href="#不同环境的编译打包运行" class="headerlink" title="不同环境的编译打包运行"></a>不同环境的编译打包运行</h2><h3 id="项目一共4套环境"><a href="#项目一共4套环境" class="headerlink" title="项目一共4套环境"></a>项目一共4套环境</h3><ul>
<li>local：本地开发的环境</li>
<li>dev：开发环境</li>
<li>test：测试环境</li>
<li>prod：正式环境</li>
</ul>
<h3 id="不同环境的打包"><a href="#不同环境的打包" class="headerlink" title="不同环境的打包"></a>不同环境的打包</h3><p>使用<code>mvn clean package -P${profile.active}</code>命令对不同环境进行打包</p>
<p>profile.active变量取值：</p>
<ul>
<li>local</li>
<li>dev</li>
<li>test</li>
<li>prod</li>
</ul>
<p>例如：要对测试环境打包，则使用命令<code>mvn clean package -Ptest</code></p>
<p>这样application.yml文件中的<code>spring.profiles.active</code>取值就是：test，从而使用<code>application-test.yml</code>文件</p>
<h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><p>本地IDE直接运行BacApplication.java</p>
<p>开发和测试环境打包后，使用<code>java -jar</code>运行即可，其他参数可自行定制，无需再指定环境</p>
<ul>
<li>对于正式环境，在jar包上传到线上服务器后，可以通过运行参数选择存放于服务器上的特定配置文件</li>
</ul>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar target/bac.jar --spring.config.location=file://$&#123;file.path&#125;</span><br></pre></td></tr></table></figure>
<p>变量file.path为配置文件路径</p>
<p>例如：</p>
<ul>
<li>linux</li>
</ul>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar target/bac.jar --spring.config.location=file:///data/bac/config/application-prod.yml</span><br></pre></td></tr></table></figure>
<ul>
<li>windows</li>
</ul>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar target/bac.jar --spring.config.location=file:///D:/bac/application-local.yml</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  profiles:</span><br><span class="line">    active: <span class="meta">@profile</span>.active@</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;profiles&gt;</span><br><span class="line">        &lt;profile&gt;</span><br><span class="line">            &lt;id&gt;local&lt;/id&gt;</span><br><span class="line">            &lt;properties&gt;</span><br><span class="line">                &lt;profile.active&gt;local&lt;/profile.active&gt;</span><br><span class="line">            &lt;/properties&gt;</span><br><span class="line">        &lt;/profile&gt;</span><br><span class="line">        &lt;profile&gt;</span><br><span class="line">            &lt;id&gt;dev&lt;/id&gt;</span><br><span class="line">            &lt;activation&gt;</span><br><span class="line">                &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;</span><br><span class="line">            &lt;/activation&gt;</span><br><span class="line">            &lt;properties&gt;</span><br><span class="line">                &lt;profile.active&gt;dev&lt;/profile.active&gt;</span><br><span class="line">            &lt;/properties&gt;</span><br><span class="line">        &lt;/profile&gt;</span><br><span class="line">        &lt;profile&gt;</span><br><span class="line">            &lt;id&gt;test&lt;/id&gt;</span><br><span class="line">            &lt;properties&gt;</span><br><span class="line">                &lt;profile.active&gt;test&lt;/profile.active&gt;</span><br><span class="line">            &lt;/properties&gt;</span><br><span class="line">        &lt;/profile&gt;</span><br><span class="line">        &lt;profile&gt;</span><br><span class="line">            &lt;id&gt;prod&lt;/id&gt;</span><br><span class="line">            &lt;properties&gt;</span><br><span class="line">                &lt;profile.active&gt;prod&lt;/profile.active&gt;</span><br><span class="line">            &lt;/properties&gt;</span><br><span class="line">        &lt;/profile&gt;</span><br><span class="line">    &lt;/profiles&gt;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://localhost:4000/2019/05/22/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wanglv Yihua">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/default_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="iyihua">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/22/hello-world/" itemprop="url">
                  Hello World
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-05-22 04:44:05" itemprop="dateCreated datePublished" datetime="2019-05-22T04:44:05+08:00">2019-05-22</time>
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="http://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="http://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="http://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://localhost:4000/2018/12/14/Go-写扩展性好的代码：函数/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wanglv Yihua">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/default_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="iyihua">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/14/Go-写扩展性好的代码：函数/" itemprop="url">
                  [Go]写扩展性好的代码：函数
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-12-14 17:36:23" itemprop="dateCreated datePublished" datetime="2018-12-14T17:36:23+08:00">2018-12-14</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-05-22 04:44:05" itemprop="dateModified" datetime="2019-05-22T04:44:05+08:00">2019-05-22</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Go/" itemprop="url" rel="index"><span itemprop="name">Go</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>如何写出扩展性好的代码？这是我工作最近半年来一直在考虑的问题。不管自己做一套系统还是接手别人的项目，只要你的项目需要和别人交互，这个问题都是需要考虑的。我们今天只说说如何写出扩展性好的函数代码。代码都以golang示例。</p>
<p>函数声明<br>函数声明首先是函数名字要具有自解释性，这个要说到代码注释了，这里就不赘述了。除了函数声明外，还有函数的形参定义。这里以一个例子来说一下扩展性好的函数的参数应该如何定义。</p>
<ol>
<li>普通函数<br>假设我们需要一个简单的server，我们可以像下面这样定义，addr表示server启动在哪个端口上。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func NewServer(addr string)</span><br></pre></td></tr></table></figure>
<p>第一期的需求很简单，就上面这些足够满足了。项目上线跑了一段时间发现，由于连接没有设置超时，很多连接一直得不到释放（异常情况），严重影响服务器性能。好，那第二期我们加个timeout。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func NewServer(addr string, timeout time.Duration)</span><br></pre></td></tr></table></figure>
<p>这个时候尴尬的情况出现了，调用你代码的所有人都需要改动代码。而且这只是一个改动，之后如果要支持tls，那么又得改动一次。</p>
<ol start="2">
<li>不定参数<br>解决上面的窘境的一种方法是使用不定参数。下面先简单介绍一下不定参数。第一次接触不定参数是学习C语言中的Hello World的代码中printf，声明如下</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">static int printf(const char *fmt, ...)</span><br></pre></td></tr></table></figure>
<p>C的函数调用可以简单看成call/ret，call的时候会把当前的IP保存起来，然后将函数地址以及函数参数入栈。printf的fmt中保存了参数的类型(%d表示int，%s表示string)并能计算出个数，这样就能找到每个具体的参数是什么了。golang也是支持不定参数的，比如我要实现一个整数加法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">func Add(list ...int) int &#123;</span><br><span class="line">    sum := 0</span><br><span class="line">    for _, x := range list &#123;</span><br><span class="line">        sum += x</span><br><span class="line">    &#125;</span><br><span class="line">    return sum</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">    fmt.Println(Add(1,2,3)) //6</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面是所有的变参都是同一种类型，如果是不同的类型可以使用interface，使用反射来判断其类型。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">func Varargs(list ...interface&#123;&#125;) &#123;</span><br><span class="line">    for _, x := range list &#123;</span><br><span class="line">        if reflect.ValueOf(x).Kind() == int &#123;</span><br><span class="line">           //</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是如果是我们自己定义的函数的话，类型通常是知道的，也就不需要上面那么麻烦地再去判断一次，可以直接进行类型转换。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">func Varargs(list ...interface&#123;&#125;) &#123;</span><br><span class="line"> //通过interface.(type)将interface类型转换成type类型</span><br><span class="line">     fmt.Println(list[0].(int))</span><br><span class="line">    fmt.Println(list[1].(string))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是这么做比较危险，使用的时候必须严格按照说明进行传参，任何一种类型不正确，程序将panic。还有一个问题就是不定参数不能为空，或者说传入的实参必须是形参的一个严格前缀。</p>
<ol start="3">
<li>封装成 struct<br>相比于上面两种方法更好一点的是把所有参数封装成struct，这样函数声明看起来很简单。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">type Param struct &#123;</span><br><span class="line">    x int</span><br><span class="line">    y string</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func Varargs(p *Param) &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>封装成struct的方式应该是一种对参数比较好的组织形式，之后函数不管怎么扩张，只需要增加struct成员就好，而不需要改变函数声明了。而struct的坏处在什么地方呢？比如上面的Param.x是int型，如果我们不设置x，也就是下面这样传参。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">p := &amp;Param&#123;</span><br><span class="line">    y: &quot;hello&quot;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Varargs(p)</span><br></pre></td></tr></table></figure>
<p>这个时候Varargs看到的Param.x的0。你让Varargs怎么想？用户没有设置x（忘记设置？想使用默认值？）？用户把x设置成0？这真的有点尴尬。但是这个问题还是有解决方案的？1.避开默认值，int型不使用0，string类型不使用””。2.使用指针，用户没有设置的时候x==nil，设置的时候对x解引用(*x)取得值。这两种方式不管怎么来看，都是十分的反人类，一点也不simple。</p>
<ol start="4">
<li>option<br>option的方式的最早是由 Rob Pike 提出，Rob Pike就不做介绍了，感兴趣的可以看他的wiki连接。我们把option参数封装成一个函数传给我们的目标函数，所有相关的工作由函数来做。举个栗子，我们现在要写个Server，timeout和tls都是可选项，那么可以像下面这么来写(所有error handle都省去)。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">func NewServer(addr string, options ...func(*Server)) (*Server, error) &#123;</span><br><span class="line">    srv := &amp;Server&#123;</span><br><span class="line">    Addr: addr,</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">   for _, option := range options &#123;</span><br><span class="line">       option(srv)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   return srv</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func timeout(d time.Duration) func(*Server) &#123;</span><br><span class="line">    return func(srv *Server) &#123;</span><br><span class="line">        srv.timeout = d</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func tls(c *config) func(*Server) &#123;</span><br><span class="line">    return func(srv *Server) &#123;</span><br><span class="line">        Tls := loadConfig(c)</span><br><span class="line">        srv.tls = Tls</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//使用</span><br><span class="line">src, err = NewServer(&quot;localhost:8080&quot;, timeout(1), tls(path/to/cert))</span><br></pre></td></tr></table></figure>
<p>这么写的好处一目了然，横向扩展起来特别方便，而且解决上面的提到的基本所有的问题。</p>
<p>函数实现<br>正常单一功能的函数实现没有什么好说的。如果需要根据不同的条件来执行不同的行为的话，这个应该怎么做的？举个例子，我现在在公司做一个优惠券的项目，用户领券和使用券的时候有一些规则，比如每人每日限领3张等。这些规则肯定不会一成不变，也许第一期是2个规则，第二期就变成4个规则了。正常可能会像下面这么写。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">func ruleVerify() &#123;</span><br><span class="line">    //process</span><br><span class="line">    if cond1 &#123;</span><br><span class="line">    //</span><br><span class="line">    &#125; else if cond2 &#123;</span><br><span class="line">    //</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>或者用switch-case。虽然很多人说switch-case写起来要比if-else更好看或者高端一点，其实我并不这么觉得。if-else和switch-case本质上并没有什么区别，扩展的时候如果需要多加一个条件分支，这两种方法改动起来都比较丑。下面说说我的解决方案。</p>
<ol>
<li>类工厂模式<br>熟悉设计模式的肯定对工厂模式肯定不会陌生。工厂模式的意思是通过参数来决定生成什么样的对象实例。我这里并不是说直接使用工厂模式而是使用工厂模式这种思想来编程。举个典型的例子，webserver的router实现方式：根据不同的路由（/foo，/bar）对应到不同的handler。光这么说，可能很多人还是不明白这种方式的扩展性好在什么地方。下面从0到1来感受一下。<br>首先根据不同的条件对应不同的handler，这个最简单的是使用Map来实现，没有问题，但是map里面存什么呢？如果我要增加一个条件以及对应的处理函数的时候怎么做呢？</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">//存放 &lt;cond, handler&gt; 对应关系</span><br><span class="line">var mux map[string]func(option *Option) error</span><br><span class="line"></span><br><span class="line">//注册handler</span><br><span class="line">func register(key string, f func(option *Option) error) &#123;</span><br><span class="line">    if mux == nil &#123;</span><br><span class="line">        mux = make(map[string]func(option *Option) error)</span><br><span class="line">    &#125;</span><br><span class="line">    if _, exist := mux[key]; exist &#123;</span><br><span class="line">        return errors.New(&quot;handler exist&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">    mux[key] = f</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//factory</span><br><span class="line">func factory(option *Option) error &#123;</span><br><span class="line">    return mux[option.Key](option)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码主要分三个部分：1.mux用来存放cond和handler的对应关系；2.register用来注册新的handler; 3.提供给外部的代码入口。下面到了最核心的问题了，如果某一天PM和你说：大神，我们现在要新加一个用户用券规则。这个时候你就可以和她说：没问题。代码上的改动只需要实现一个新增规则的实现函数，同时调用一下register即可。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://localhost:4000/2018/12/13/elasticsearch-windows下安装elasticsearch5-6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wanglv Yihua">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/default_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="iyihua">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/13/elasticsearch-windows下安装elasticsearch5-6/" itemprop="url">
                  [elasticsearch]windows下安装elasticsearch5-6
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-12-13 17:56:28" itemprop="dateCreated datePublished" datetime="2018-12-13T17:56:28+08:00">2018-12-13</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-05-22 04:44:05" itemprop="dateModified" datetime="2019-05-22T04:44:05+08:00">2019-05-22</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/elasticsearch/" itemprop="url" rel="index"><span itemprop="name">elasticsearch</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>elasticsearch&gt;5后，elasticsearch-head</p>
<p>不能放在elasticsearch的 plugins、modules 目录下</p>
<p>不能使用 elasticsearch-plugin install</p>
<p>直接启动elasticsearch即可</p>
<p>安装 elasticsearch-head</p>
<p>修改 elasticsearch/config/elasticsearch.yml</p>
<p>添加<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http.cors.enabled: true</span><br><span class="line">http.cors.allow-origin: &quot;*&quot;</span><br></pre></td></tr></table></figure></p>
<p>下载 elasticsearch-head 或者 git clone 到随便一个文件夹</p>
<p>安装nodejs<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd /path/to/elasticsearch-head</span><br><span class="line"></span><br><span class="line">npm install -g grunt-cli</span><br><span class="line"></span><br><span class="line">npm install</span><br><span class="line"></span><br><span class="line">grunt server</span><br></pre></td></tr></table></figure></p>
<p><a href="http://localhost:9100/">http://localhost:9100/</a></p>
<p>Enjoy it.</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://localhost:4000/2018/12/13/design-多认证方式的情况下如何设计帐号模型表/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wanglv Yihua">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/default_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="iyihua">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/13/design-多认证方式的情况下如何设计帐号模型表/" itemprop="url">
                  [design]多认证方式的情况下如何设计帐号模型表
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-12-13 17:48:44" itemprop="dateCreated datePublished" datetime="2018-12-13T17:48:44+08:00">2018-12-13</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-05-22 04:44:05" itemprop="dateModified" datetime="2019-05-22T04:44:05+08:00">2019-05-22</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/design/" itemprop="url" rel="index"><span itemprop="name">design</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="用户帐号登录表设计"><a href="#用户帐号登录表设计" class="headerlink" title="用户帐号登录表设计"></a>用户帐号登录表设计</h1><p>当存在密码登录、第三方授权登录等登录方式的时候，系统的用户帐号模型应该如何设计？</p>
<h2 id="1-首先，这是一种思考方案"><a href="#1-首先，这是一种思考方案" class="headerlink" title="1. 首先，这是一种思考方案"></a>1. 首先，这是一种思考方案</h2><p>用户profile表一张，相当于用户总表</p>
<p>帐号密码登录，作为一种登录方式，搞一张表</p>
<p>OAuth作为一种登录方式，也建一张表；如果还有别的登录方式，也可以创建对应的认证表；</p>
<p>有些网站需要API访问，API可以使用api_key和api_secret来认证，可是怎么把一个API访问关联到一个用户？方法还是增加一种API Auth的表：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id | user_id | api_key  | api_secret</span><br></pre></td></tr></table></figure></p>
<p>每一种X-Auth表都存储了用户的登录认证信息，并通过user_id关联到Users表。这样一来，不但登录过程简化了，而且一个用户可以使用多种方式登录。只要登录成功，拿到了user_id，最后读取Users表是为了获得用户的Profile</p>
<h2 id="2-另一种思路："><a href="#2-另一种思路：" class="headerlink" title="2. 另一种思路："></a>2. 另一种思路：</h2><p>用户总表，含平台唯一uid；</p>
<p>每一个app，都注册登录过，会有对应的appuserid；</p>
<p>不同app通过一个和总表的关联表关联起来<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">本地用户唯一ID  社交网络类型  社交网络唯一ID</span><br><span class="line">1112  weibo 20</span><br><span class="line">5111  qq  20</span><br><span class="line">6000  weixin  10</span><br><span class="line">6000  qq  300</span><br></pre></td></tr></table></figure></p>
<h2 id="3-目前第三方登录通常有两种设计思路"><a href="#3-目前第三方登录通常有两种设计思路" class="headerlink" title="3. 目前第三方登录通常有两种设计思路"></a>3. 目前第三方登录通常有两种设计思路</h2><h3 id="1、将第三方登录看成一种登录方式，使用第三方登录的前提是，你先要有一个账户。"><a href="#1、将第三方登录看成一种登录方式，使用第三方登录的前提是，你先要有一个账户。" class="headerlink" title="1、将第三方登录看成一种登录方式，使用第三方登录的前提是，你先要有一个账户。"></a>1、将第三方登录看成一种登录方式，使用第三方登录的前提是，你先要有一个账户。</h3><p>缺点：当用户没有账户，直接使用第三方登录时，你只能提示他先去注册账户。但在用户看来，就是欺骗，容易引起用户的反感。</p>
<p>优点：当用户账户绑定了第三方账号后，用户就在也不用记住密码了，完全可以通过各个熟悉的第三方账号登录系统。</p>
<h3 id="2、将第三方登录，看成一个独立的用户"><a href="#2、将第三方登录，看成一个独立的用户" class="headerlink" title="2、将第三方登录，看成一个独立的用户"></a>2、将第三方登录，看成一个独立的用户</h3><p>优点：没有注册流程，容易吸引用户，由于是第三方直接登录，也不需要考虑用户会忘记密码</p>
<p>缺点：一个人容易产生多个账户，用户的行为容易分散到多个账户中，增加了系统的复杂性，某些情况下还会影响用户的产品体验。</p>
<p>通篇看下来，第三方登录并没有想象中的那么美好，第一种方式也就仅仅解决用户忘记密码的问题，注册时还会引起用户反感。第二种方式虽然能起到吸引用户的作用，但却增加了系统的复杂性，某些情况下还会影响用户的产品体验。</p>
<p>所以，大家可以根据自己的实际情况，考虑是否要添加第三方登录的支持，如果要，应该使用哪种第三方登录的模式。</p>
<h2 id="4-user-auths表例子"><a href="#4-user-auths表例子" class="headerlink" title="4. user_auths表例子"></a>4. user_auths表例子</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">user_auths</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">id             # 自增id</span><br><span class="line">user_id        # users表对应的id</span><br><span class="line">identity_type  # 身份类型（站内username 邮箱email 手机mobile 或者第三方的qq weibo weixin等等）</span><br><span class="line">identifier     # 身份唯一标识（存储唯一标识，比如账号、邮箱、手机号、第三方获取的唯一标识等）</span><br><span class="line">credential     # 授权凭证（比如密码 第三方登录的token等）</span><br><span class="line">verified       # 是否已经验证（存储 1、0 来区分是否已经验证通过）</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/default_avatar.jpg" alt="Wanglv Yihua">
            
              <p class="site-author-name" itemprop="name">Wanglv Yihua</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">82</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">20</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">206</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Wanglv Yihua</span>

  

  
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动 v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Muse</a> v6.4.1</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.4.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.4.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.1"></script>



  



  










  





  

  

  

  

  
  

  

  

  

  

  

</body>
</html>
